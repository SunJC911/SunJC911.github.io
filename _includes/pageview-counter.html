<!-- 自定义GoatCounter页面浏览量计数器 -->
<span id="goatcounter-pageview-counter">加载中...</span>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    // 获取当前页面的路径
    var path = window.location.pathname;

    // 创建一个访问GoatCounter API的请求
    var xhr = new XMLHttpRequest();
    xhr.open(
      "GET",
      "https://09110911.goatcounter.com/counter/" +
        encodeURIComponent(path) +
        ".json",
      true
    );

    xhr.onload = function () {
      if (xhr.status === 200) {
        try {
          var data = JSON.parse(xhr.responseText);
          // 显示总访问量
          if (data && data.count) {
            document.getElementById(
              "goatcounter-pageview-counter"
            ).textContent = "实际访问量: " + data.count + " 次浏览";
          } else {
            document.getElementById(
              "goatcounter-pageview-counter"
            ).textContent = "访问量: 获取失败";
          }
        } catch (e) {
          console.error("解析GoatCounter数据失败:", e);
          document.getElementById("goatcounter-pageview-counter").textContent =
            "访问量: 解析错误";
        }
      } else {
        document.getElementById("goatcounter-pageview-counter").textContent =
          "访问量: 获取失败 (" + xhr.status + ")";
      }
    };

    xhr.onerror = function () {
      document.getElementById("goatcounter-pageview-counter").textContent =
        "访问量: 网络错误";
    };

    xhr.send();
  });
</script>
